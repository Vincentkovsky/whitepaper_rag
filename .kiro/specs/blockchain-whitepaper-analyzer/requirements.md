# 需求文档

## 简介

区块链白皮书解读器是一个基于 AI 的 SaaS 平台，旨在帮助用户快速理解和分析区块链项目白皮书。系统通过 RAG（检索增强生成）技术，结合大语言模型，为用户提供智能问答、多维度分析报告和历史记录管理等功能。

## 术语表

- **系统**: 区块链白皮书解读器 SaaS 平台
- **用户**: 使用平台分析白皮书的注册用户
- **白皮书**: 区块链项目的技术文档（PDF 格式或网页 URL）
- **解析任务**: 系统对上传白皮书进行处理和分析的异步任务
- **分析报告**: 系统生成的包含技术、经济、团队、风险等维度的综合分析结果
- **向量数据库**: 存储文档向量化表示的数据库（Chroma）
- **业务数据库**: 存储用户信息、订阅、文档元数据的关系型数据库（Supabase PostgreSQL）
- **AI 引擎**: 基于 LangGraph 和 LLM 的智能分析引擎
- **订阅计划**: 用户购买的服务套餐（免费版/基础版/专业版/企业版）
- **配额**: 用户在订阅计划内可使用的白皮书解析次数

## 需求

### 需求 1：用户注册与认证

**用户故事:** 作为一个新用户，我想要注册账号并登录系统，以便使用白皮书解读服务

#### 验收标准

1. THE 系统 SHALL 提供邮箱和密码注册功能
2. THE 系统 SHALL 支持 OAuth 第三方登录（Google、GitHub）
3. THE 系统 SHALL 在用户注册成功后发送验证邮件
4. WHEN 用户点击验证链接，THE 系统 SHALL 激活用户账号
5. THE 系统 SHALL 提供密码重置功能通过邮箱验证

### 需求 2：白皮书上传与存储

**用户故事:** 作为一个已登录用户，我想要上传区块链白皮书文件或提供网页链接，以便系统进行分析

#### 验收标准

1. THE 系统 SHALL 支持 PDF 格式的文件上传
2. THE 系统 SHALL 支持通过 URL 输入抓取网页内容
3. THE 系统 SHALL 限制单个 PDF 文件大小不超过 50MB
4. WHEN 用户上传 PDF 文件，THE 系统 SHALL 验证文件格式和大小
5. WHEN 用户输入网页 URL，THE 系统 SHALL 验证 URL 格式的有效性
6. IF 文件格式不支持或超过大小限制，THEN THE 系统 SHALL 显示错误提示并拒绝上传
7. IF URL 格式无效或网页无法访问，THEN THE 系统 SHALL 显示错误提示
8. THE 系统 SHALL 将上传的 PDF 文件存储到 Supabase Storage
9. THE 系统 SHALL 抓取网页内容并转换为结构化文本
10. THE 系统 SHALL 在业务数据库中记录文档元数据（来源类型、文件名或 URL、大小、上传时间、用户 ID）

### 需求 3：文档解析与向量化

**用户故事:** 作为系统管理员，我需要系统能够自动解析上传的白皮书并进行向量化处理，以便支持后续的智能问答

#### 验收标准

1. WHEN 文件上传成功或 URL 提交成功，THE 系统 SHALL 创建异步解析任务
2. THE 系统 SHALL 使用 Unstructured 库提取 PDF 文档文本内容
3. THE 系统 SHALL 使用网页抓取工具（BeautifulSoup 或 Playwright）提取网页内容
4. THE 系统 SHALL 识别文档结构（标题、段落、表格、图表）
5. THE 系统 SHALL 将文档分块处理，每块大小在 500-1000 tokens 之间
6. THE 系统 SHALL 使用 OpenAI text-embedding-3-large 模型生成文本向量
7. THE 系统 SHALL 将向量数据存储到 Chroma 向量数据库
8. THE 系统 SHALL 在解析过程中更新任务状态（处理中、已完成、失败）

### 需求 4：智能问答功能

**用户故事:** 作为一个用户，我想要针对已上传的白皮书提问，以便快速获取特定信息

#### 验收标准

1. WHEN 用户输入问题，THE 系统 SHALL 将问题向量化
2. THE 系统 SHALL 从向量数据库中检索相关文档片段（Top-K=5）
3. THE 系统 SHALL 使用 LangGraph 构建 RAG 工作流
4. THE 系统 SHALL 将检索到的上下文和用户问题发送给 GPT-4-Turbo
5. THE 系统 SHALL 返回 AI 生成的答案并标注引用来源
6. THE 系统 SHALL 在 3 秒内返回简单查询的响应
7. THE 系统 SHALL 记录每次问答历史到业务数据库

### 需求 5：多维度分析报告生成

**用户故事:** 作为一个用户，我想要获取白皮书的综合分析报告，以便全面了解项目情况

#### 验收标准

1. WHEN 用户请求生成分析报告，THE 系统 SHALL 创建分析任务
2. THE 系统 SHALL 从技术架构、经济模型、团队背景、风险评估四个维度进行分析
3. THE 系统 SHALL 使用 LangGraph 编排多步骤分析工作流
4. THE 系统 SHALL 为每个维度生成结构化分析结果
5. THE 系统 SHALL 生成综合评分（0-100 分）
6. THE 系统 SHALL 将分析报告存储到业务数据库
7. THE 系统 SHALL 支持报告导出为 PDF 和 Markdown 格式

### 需求 6：异步任务处理与进度通知

**用户故事:** 作为一个用户，我想要实时了解文档解析和分析的进度，以便知道何时可以查看结果

#### 验收标准

1. THE 系统 SHALL 使用 Celery 和 Redis 实现异步任务队列
2. WHEN 创建解析或分析任务，THE 系统 SHALL 返回唯一任务 ID
3. THE 系统 SHALL 通过 WebSocket 推送任务进度更新（0-100%）
4. WHEN 任务完成，THE 系统 SHALL 发送完成通知
5. IF 任务失败，THEN THE 系统 SHALL 记录错误信息并通知用户
6. THE 系统 SHALL 支持用户查询任务状态

### 需求 7：订阅管理与配额控制

**用户故事:** 作为一个用户，我想要订阅付费计划，以便获得更多的白皮书解析配额

#### 验收标准

1. THE 系统 SHALL 提供四种订阅计划（免费版、基础版、专业版、企业版）
2. THE 系统 SHALL 集成 Lemon Squeezy 处理支付
3. WHEN 用户订阅成功，THE 系统 SHALL 通过 Webhook 更新订阅状态
4. THE 系统 SHALL 根据订阅计划分配月度配额
5. WHEN 用户上传白皮书，THE 系统 SHALL 检查剩余配额
6. IF 配额不足，THEN THE 系统 SHALL 阻止上传并提示升级订阅
7. THE 系统 SHALL 在每月 1 号重置配额

### 需求 8：历史记录管理

**用户故事:** 作为一个用户，我想要查看我的历史解析记录和问答记录，以便回顾之前的分析结果

#### 验收标准

1. THE 系统 SHALL 显示用户所有已上传的白皮书列表
2. THE 系统 SHALL 为每个白皮书显示上传时间、文件名、解析状态
3. WHEN 用户点击白皮书，THE 系统 SHALL 显示该文档的所有问答历史
4. THE 系统 SHALL 支持按时间、文件名搜索历史记录
5. THE 系统 SHALL 允许用户删除历史记录
6. WHEN 用户删除白皮书，THE 系统 SHALL 同时删除相关的向量数据和问答记录

### 需求 9：API 访问（专业版及以上）

**用户故事:** 作为一个专业版用户，我想要通过 API 访问系统功能，以便集成到我的应用中

#### 验收标准

1. WHERE 用户订阅专业版或企业版，THE 系统 SHALL 提供 API 密钥
2. THE 系统 SHALL 提供 RESTful API 端点用于上传、查询、分析
3. THE 系统 SHALL 使用 API 密钥进行身份验证
4. THE 系统 SHALL 实施 API 速率限制（基础版：100 次/小时，专业版：1000 次/小时）
5. THE 系统 SHALL 提供 OpenAPI 文档
6. THE 系统 SHALL 记录所有 API 调用日志

### 需求 10：系统监控与错误处理

**用户故事:** 作为系统管理员，我需要监控系统运行状态和错误，以便及时发现和解决问题

#### 验收标准

1. THE 系统 SHALL 集成 Sentry 进行错误追踪
2. WHEN 发生未捕获异常，THE 系统 SHALL 自动上报到 Sentry
3. THE 系统 SHALL 记录所有 API 请求日志（请求路径、响应时间、状态码）
4. THE 系统 SHALL 监控 LLM API 调用成本和延迟
5. THE 系统 SHALL 在 Redis 中缓存常见问题答案，缓存时间为 1 小时
6. THE 系统 SHALL 实施请求限流防止滥用（每用户 10 次/分钟）

### 需求 11：数据安全与隐私

**用户故事:** 作为一个用户，我希望我的数据是安全的，只有我能访问我上传的白皮书

#### 验收标准

1. THE 系统 SHALL 使用 Supabase Row Level Security 确保数据隔离
2. THE 系统 SHALL 仅允许用户访问自己上传的文档
3. THE 系统 SHALL 对存储的文件进行加密
4. THE 系统 SHALL 在用户删除账号时清除所有相关数据
5. THE 系统 SHALL 使用 HTTPS 加密所有网络传输
6. THE 系统 SHALL 不在日志中记录敏感信息（密码、API 密钥）

### 需求 12：响应式前端界面

**用户故事:** 作为一个用户，我想要在不同设备上使用系统，以便随时随地访问

#### 验收标准

1. THE 系统 SHALL 提供响应式 Web 界面支持桌面和移动设备
2. THE 系统 SHALL 使用 Vue 3 和 TypeScript 构建前端
3. THE 系统 SHALL 使用 Element Plus 作为 UI 组件库
4. THE 系统 SHALL 支持拖拽上传文件
5. THE 系统 SHALL 使用 Markdown 渲染分析报告
6. THE 系统 SHALL 使用 ECharts 可视化分析数据
7. THE 系统 SHALL 在移动设备上提供简化的界面布局

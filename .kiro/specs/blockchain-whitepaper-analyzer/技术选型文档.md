# 区块链白皮书解读器 SaaS - 技术选型文档

## 项目概述
构建一个基于 AI 的区块链项目白皮书智能解读 SaaS 平台，帮助用户快速理解和分析区块链项目白皮书。

## 技术架构总览

```
前端层: Vue 3 + TypeScript
    ↓
API 层: FastAPI (Python)
    ↓
AI 处理层: LangGraph + OpenAI GPT-4/Deepseek
    ↓
数据层: Chroma (向量数据库) + Supabase (业务数据)
    ↓
SaaS 基础设施: Supabase (认证) + Lemon Squeezy (支付)
```

---

## 后端技术栈

### 1. Python + FastAPI ✅ **推荐**
**选择理由：**
- FastAPI 性能优秀，支持异步处理，适合 AI 密集型应用
- Python 生态在 AI/ML 领域最成熟
- 自动生成 OpenAPI 文档，前后端协作友好
- 类型提示支持，代码质量高

**替代方案对比：**
- Node.js + Express：生态不如 Python AI 工具链完善
- Django：过于重量级，不适合 API 服务

---

### 2. LangGraph (RAG 框架) ✅ **推荐**
**选择理由：**
- 专为复杂 AI 工作流设计，支持状态管理
- 与 LangChain 生态无缝集成
- 适合白皮书解读的多步骤分析流程

**优化建议：**
- 考虑同时集成 **LlamaIndex**，它在文档问答场景表现更好
- LangGraph 处理复杂工作流，LlamaIndex 处理简单查询

**工作流示例：**
```
上传白皮书 → 文档解析 → 分块处理 → 向量化 → 
多维度分析（技术/经济/团队/风险）→ 生成报告
```

---

### 3. Chroma (向量数据库) ⚠️ **可优化**
**当前选择：** Chroma - 轻量级，适合快速开发

**优化建议：**
根据规模选择：
- **小规模（< 10万文档）**: Chroma ✅
- **中等规模**: **Qdrant** 或 **Weaviate**（性能更好，支持多租户）
- **大规模**: **Pinecone**（托管服务，无需运维）

**推荐方案：** 
- 初期使用 Chroma
- 预留接口抽象层，方便后期迁移

---

### 4. Unstructured (PDF 解析) ✅ **推荐 + 补充**
**选择理由：**
- 支持多种文档格式（PDF/DOCX/HTML）
- 自动识别文档结构（标题/表格/图表）

**补充方案：**
- **PyMuPDF (fitz)**：处理复杂 PDF 布局
- **pdfplumber**：精确提取表格数据
- **Marker**：开源 PDF 转 Markdown，保留格式

**建议组合：**
```python
Unstructured (主解析器) 
  + PyMuPDF (处理图像/复杂布局)
  + OCR (Tesseract/PaddleOCR) 处理扫描版 PDF
```

---

### 5. OpenAI GPT-4 + Embeddings ✅ **推荐 + 备选**
**主力方案：**
- GPT-4-Turbo：理解能力强，适合深度分析
- text-embedding-3-large：向量质量高

**成本优化建议：**
- **Claude 3.5 Sonnet**：性价比高，上下文窗口大（200K）
- **GPT-4o-mini**：简单查询场景，成本降低 90%
- **本地模型**：Llama 3.1 70B（私有化部署，降低长期成本）

**混合策略：**
```
简单查询 → GPT-4o-mini
复杂分析 → GPT-4-Turbo / Claude 3.5
向量化 → text-embedding-3-small（成本更低）
```

---

## 前端技术栈

### Vue 3 + TypeScript ✅ **推荐**
**选择理由：**
- Vue 3 组合式 API 开发效率高
- TypeScript 提供类型安全
- 生态成熟，组件库丰富

**推荐配套：**
- **UI 框架**: Element Plus / Ant Design Vue
- **状态管理**: Pinia
- **HTTP 客户端**: Axios
- **文件上传**: vue-upload-component
- **Markdown 渲染**: markdown-it / marked
- **图表展示**: ECharts（展示白皮书数据分析）

**替代方案：**
- React + TypeScript：生态更大，但学习曲线陡
- Next.js：如需 SEO 优化可考虑

---

## SaaS 基础设施

### 1. Supabase ✅ **强烈推荐**
**功能覆盖：**
- ✅ 用户认证（邮箱/OAuth/Magic Link）
- ✅ PostgreSQL 数据库（存储用户数据/解析历史）
- ✅ 实时订阅（解析进度推送）
- ✅ 存储服务（白皮书文件存储）
- ✅ Row Level Security（数据安全）

**数据模型建议：**
```sql
users (Supabase Auth)
  ↓
subscriptions (订阅信息)
  ↓
documents (上传的白皮书)
  ↓
analysis_results (解析结果)
  ↓
usage_logs (API 调用记录)
```

---

### 2. Lemon Squeezy ✅ **推荐**
**选择理由：**
- 支持全球支付（信用卡/PayPal）
- 自动处理税务合规
- Webhook 集成简单
- 无需 Stripe 的复杂配置

**替代方案：**
- **Stripe**：功能更强大，但配置复杂
- **Paddle**：类似 Lemon Squeezy，欧洲用户友好

**订阅方案建议：**
```
免费版: 3 份白皮书/月
基础版: $29/月 - 50 份白皮书
专业版: $99/月 - 无限白皮书 + API 访问
企业版: 定制价格 - 私有化部署
```

---

## 补充技术建议

### 1. 任务队列 ⭐ **强烈建议添加**
白皮书解析是耗时操作，需要异步处理：

**推荐方案：**
- **Celery + Redis**：Python 生态标准方案
- **Dramatiq**：更轻量，性能更好
- **Temporal**：复杂工作流（如果需要重试/补偿机制）

**工作流：**
```
用户上传 → 返回任务 ID → 后台处理 → WebSocket 推送进度 → 完成通知
```

---

### 2. 缓存层 ⭐ **建议添加**
**Redis 用途：**
- 缓存常见问题答案
- 限流（防止滥用）
- 会话管理
- 任务队列

---

### 3. 监控与日志
**推荐工具：**
- **Sentry**：错误追踪
- **PostHog**：用户行为分析
- **Logfire**：Python 应用监控（Pydantic 团队出品）

---

### 4. 部署方案
**推荐：**
- **后端**: Railway / Render / Fly.io（支持 Python + Redis）
- **前端**: Vercel / Netlify
- **向量数据库**: 
  - Chroma：自托管在后端服务器
  - Pinecone：托管服务（推荐）

**Docker 化：**
```dockerfile
# 后端容器
FastAPI + Celery Worker + Redis + Chroma
```

---

## 技术风险与应对

### 1. 成本控制
**风险**: OpenAI API 成本高
**应对**: 
- 实施请求缓存
- 使用更便宜的模型处理简单任务
- 设置用户配额限制

### 2. PDF 解析准确性
**风险**: 复杂布局/扫描版 PDF 解析失败
**应对**:
- 多解析器组合
- 人工审核机制
- 用户反馈优化

### 3. 向量数据库扩展性
**风险**: Chroma 性能瓶颈
**应对**:
- 设计抽象层
- 预留迁移方案

---

## 开发路线图

### MVP 阶段（4-6 周）
1. ✅ 基础架构搭建
2. ✅ PDF 上传与解析
3. ✅ 简单问答功能
4. ✅ 用户认证（Supabase）
5. ✅ 基础付费（Lemon Squeezy）

### V1.0 阶段（8-12 周）
1. ✅ 多维度分析报告
2. ✅ 异步任务处理
3. ✅ 历史记录管理
4. ✅ 导出功能（PDF/Markdown）

### V2.0 阶段（3-6 月）
1. ✅ 批量分析
2. ✅ API 开放平台
3. ✅ 自定义分析模板
4. ✅ 团队协作功能

---

## 总结

你的技术选型 **90% 合适**，建议优化点：

1. ✅ **保持**: FastAPI, LangGraph, Unstructured, Supabase, Lemon Squeezy
2. ⚠️ **考虑升级**: Chroma → Qdrant/Pinecone（规模化后）
3. ⭐ **建议添加**: 
   - Celery/Dramatiq（任务队列）
   - Redis（缓存）
   - 混合 LLM 策略（成本优化）

这个技术栈可以支撑你从 MVP 到规模化的完整旅程。


